/*!
 * jQuery Video Background plugin
 * https://github.com/georgepaterson/jquery-videobackground
 *
 * Copyright 2012, George Paterson
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 */
(function(n,t,i){"use strict";function r(r){var f=n(t).height(),u=n(i).height();r.settings.resizeTo==="window"?n(r).css("height",u):u>=f?n(r).css("height",u):n(r).css("height",f)}function s(t){n(t.controlbox).append(t.settings.preloadHtml);t.settings.preloadCallback&&t.settings.preloadCallback.call(t)}function f(t){var i=t.find("video").get(0),r;r=t.settings.controlPosition?n(t.settings.controlPosition).find(".ui-video-background-play a"):t.find(".ui-video-background-play a");i.paused?(i.play(),r.toggleClass("ui-icon-pause ui-icon-play").text(t.settings.controlText[1])):i.ended?(i.play(),r.toggleClass("ui-icon-pause ui-icon-play").text(t.settings.controlText[1])):(i.pause(),r.toggleClass("ui-icon-pause ui-icon-play").text(t.settings.controlText[0]))}function e(t){var i=t.find("video").get(0),r;r=t.settings.controlPosition?n(t.settings.controlPosition).find(".ui-video-background-mute a"):t.find(".ui-video-background-mute a");i.volume===0?(i.volume=1,r.toggleClass("ui-icon-volume-on ui-icon-volume-off").text(t.settings.controlText[2])):(i.volume=0,r.toggleClass("ui-icon-volume-on ui-icon-volume-off").text(t.settings.controlText[3]))}function h(t){if(t.settings.resize)n(i).on("resize",function(){r(t)});t.controls.find(".ui-video-background-play a").on("click",function(n){n.preventDefault();f(t)});t.controls.find(".ui-video-background-mute a").on("click",function(n){n.preventDefault();e(t)});if(t.settings.loop)t.find("video").on("ended",function(){n(this).get(0).play();n(this).toggleClass("paused").text(t.settings.controlText[1])})}function o(t){n(t.controlbox).html(t.controls);h(t);t.settings.loadedCallback&&t.settings.loadedCallback.call(t)}var u={init:function(i){return this.each(function(){var u=n(this),e="",f="",c=u.data("video-options"),l,h;if(t.createElement("video").canPlayType){if(u.settings=n.extend(!0,{},n.fn.videobackground.defaults,c,i),!u.settings.initialised){if(u.settings.initialised=!0,u.settings.resize&&r(u),n.each(u.settings.videoSource,function(){h=Object.prototype.toString.call(this)==="[object Array]";e=h&&this[1]!==undefined?e+'<source src="'+this[0]+'" type="'+this[1]+'">':h?e+'<source src="'+this[0]+'">':e+'<source src="'+this+'">'}),f=f+'preload="'+u.settings.preload+'"',u.settings.poster&&(f=f+' poster="'+u.settings.poster+'"'),u.settings.autoplay&&(f=f+' autoplay="autoplay"'),u.settings.loop&&(f=f+' loop="loop"'),n(u).html("<video "+f+">"+e+"<\/video>"),u.controlbox=n('<div class="ui-video-background ui-widget ui-widget-content ui-corner-all"><\/div>'),u.settings.controlPosition?n(u.settings.controlPosition).append(u.controlbox):n(u).append(u.controlbox),u.controls=n('<ul class="ui-video-background-controls"><li class="ui-video-background-play"><a class="ui-icon ui-icon-pause" href="#">'+u.settings.controlText[1]+'<\/a><\/li><li class="ui-video-background-mute"><a class="ui-icon ui-icon-volume-on" href="#">'+u.settings.controlText[2]+"<\/a><\/li><\/ul>"),u.settings.preloadHtml||u.settings.preloadCallback){s(u);u.find("video").on("canplaythrough",function(){u.settings.autoplay&&u.find("video").get(0).play();o(u)})}else u.find("video").on("canplaythrough",function(){u.settings.autoplay&&u.find("video").get(0).play();o(u)});u.data("video-options",u.settings)}}else u.settings=n.extend(!0,{},n.fn.videobackground.defaults,c,i),u.settings.initialised||(u.settings.initialised=!0,u.settings.poster&&(l=n('<img class="ui-video-background-poster" src="'+u.settings.poster+'">'),u.append(l)),u.data("video-options",u.settings))})},play:function(t){return this.each(function(){var i=n(this),r=i.data("video-options");i.settings=n.extend(!0,{},r,t);i.settings.initialised&&(f(i),i.data("video-options",i.settings))})},mute:function(t){return this.each(function(){var i=n(this),r=i.data("video-options");i.settings=n.extend(!0,{},r,t);i.settings.initialised&&(e(i),i.data("video-options",i.settings))})},resize:function(t){return this.each(function(){var i=n(this),u=i.data("video-options");i.settings=n.extend(!0,{},u,t);i.settings.initialised&&(r(i),i.data("video-options",i.settings))})},destroy:function(r){return this.each(function(){var u=n(this),f=u.data("video-options");u.settings=n.extend(!0,{},f,r);u.settings.initialised&&(u.settings.initialised=!1,t.createElement("video").canPlayType?(u.find("video").off("ended"),u.settings.controlPosition?(n(u.settings.controlPosition).find(".ui-video-background-mute a").off("click"),n(u.settings.controlPosition).find(".ui-video-background-play a").off("click")):(u.find(".ui-video-background-mute a").off("click"),u.find(".ui-video-background-play a").off("click")),n(i).off("resize"),u.find("video").off("canplaythrough"),u.settings.controlPosition?n(u.settings.controlPosition).find(".ui-video-background").remove():u.find(".ui-video-background").remove(),n("video",u).remove()):u.settings.poster&&u.find(".ui-video-background-poster").remove(),u.removeData("video-options"))})}};n.fn.videobackground=function(t){if(!this.length)return this;if(u[t])return u[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return u.init.apply(this,arguments);n.error("Method "+t+" does not exist on jQuery.videobackground")};n.fn.videobackground.defaults={videoSource:[],poster:null,autoplay:!0,preload:"auto",loop:!1,controlPosition:null,controlText:["Play","Pause","Mute","Unmute"],resize:!0,preloadHtml:"",preloadCallback:null,loadedCallback:null,resizeTo:"document"}})(jQuery,document,window);