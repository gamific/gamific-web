function loadCampaignsDataTable(){table=$("#campaignDataTable").dataTable({serverSide:!0,ajax:"/admin/campanhas/search",processing:!0,pagingType:"simple",scrollY:"300px",scrollCollapse:!0,ordering:!0,deferRender:!0,lengthChange:!1,language:{emptyTable:"N�o foram encontrados resultados.",paginate:{previous:'<i class="fa fa-angle-left"><\/i>',next:'<i class="fa fa-angle-right"><\/i>'}},dom:'<"newtoolbar">frtip',fnServerParams:function(n){n.search.value+=""},columnDefs:[{width:"90%",targets:0,orderable:!0,searchable:!0},{width:"10%",targets:1,searchable:!1,orderable:!1,render:function(n){var t="<a class='fa fa-pencil' href='/admin/campanhas/editar/"+n+"' title='Editar Campanha.'> <\/a> &nbsp;";return($("#CurrentProfile").val()=="SUPERVISOR DE CAMPANHA"||$("#CurrentProfile").val()=="ADMINISTRADOR")&&(t+="<a class='fa fa-remove' href='/admin/campanhas/remover/"+n+"' title='Remover Campanha.'> <\/a>"),t}}]})}function loadTeamsToAssociate(){var n=$("#TeamsId").val().length>0?$("#TeamsId").val():",";table=$("#associateTeamsDataTable").dataTable({serverSide:!0,ajax:"/admin/campanhas/associarEquipes/"+$("#ProfileId").val()+"/"+($("#SponsorId").val()!=""?$("#SponsorId").val():0)+"/"+$("#Id").val()+"/"+n,processing:!0,pagingType:"simple",scrollY:"300px",scrollCollapse:!0,deferRender:!0,lengthChange:!1,language:{emptyTable:"N�o foram encontrados resultados.",paginate:{previous:'<i class="fa fa-angle-left"><\/i>',next:'<i class="fa fa-angle-right"><\/i>'}},dom:'<"newtoolbar">frtip',fnServerParams:function(n){n.search.value+=""},columnDefs:[{width:"10%",targets:0,searchable:!1,orderable:!1,render:function(n){return"<input type='checkbox' class='teamsIdList' value='"+n+"'>"}},{width:"40%",targets:1,orderable:!0,searchable:!0},{width:"40%",targets:2,orderable:!0,searchable:!0},{width:"10%",targets:3,orderable:!1,searchable:!1,render:function(n){return"<input type='number' class='teamsGoalList' id='teamsGoalList;"+n+"'>"}}]})}function loadTeamsFromCampaign(){$("#teamsFromCampaignDataTable").dataTable().fnDestroy();var n=$("#TeamsId").val().length>0?$("#TeamsId").val():"!key!";table=$("#teamsFromCampaignDataTable").dataTable({serverSide:!0,ajax:"/admin/campanhas/carregarEquipes/"+$("#Id").val()+"/"+n,processing:!0,pagingType:"simple",scrollY:"300px",width:"100%",scrollCollapse:!0,deferRender:!0,lengthChange:!1,language:{emptyTable:"N�o foram encontrados resultados.",paginate:{previous:'<i class="fa fa-angle-left"><\/i>',next:'<i class="fa fa-angle-right"><\/i>'}},dom:'<"newtoolbar">frtip',fnServerParams:function(n){n.search.value+=""},columnDefs:[{width:"30%",targets:0,orderable:!0,searchable:!0,render:function(n){return n.split(";")[0]+"<img src='/api/media/"+n.split(";")[1]+"?cache=@Html.Raw(DateTime.Now.Millisecond)' style='width: 48px !important; height: 48px !important; border-radius:100%; float: left; margin-right: 10px;' />"}},{width:"30%",targets:1,orderable:!0,searchable:!0},{width:"30%",targets:2,searchable:!1,orderable:!1,render:function(n){var t="";return n.split(";")[1]!="0"&&($("#CurrentProfile").val()=="SUPERVISOR DE CAMPANHA"||$("#CurrentProfile").val()=="ADMINISTRADOR"||$("#CurrentProfile").val()=="SUPERVISOR DE EQUIPE"&&n.split(";")[2]==$("#CurrentWorker").val())&&(t="<a id='demo-dt-addrow-btn' class='btn btn-default sing-up-button' href='/admin/equipes/detalheEquipe/"+n.split(";")[0]+"?CampaignTeamId="+n.split(";")[1]+"'title='Lan�ar Resultado' >Lan�ar Resultado<\/a>"),t}},{width:"10%",targets:3,searchable:!1,orderable:!1,render:function(n){var t="",i,r;return($("#CurrentProfile").val()=="SUPERVISOR DE CAMPANHA"||$("#CurrentProfile").val()=="ADMINISTRADOR")&&(i=n.split(";")[0],i!="0"?t="<a class='fa fa-remove' onclick='removeTeamFromServer("+i+");' href='#' title='Remover Equipe.'> <\/a>":(r=n.split(";")[1],t="<a class='fa fa-remove' href='#' onclick='RemoveTableRow(this),RemoveFromDatatable("+r+")'> <\/a>")),t}}]})}function addRow(n){var y=n.parentNode.parentNode,t=y.parentNode,p=t.rows.length,w=t.insertRow(p),e=w.insertCell(0),h=document.createElement("i"),o,i,r,u,f,s,v,c,l,a;for(h.className="fa fa-remove",h.title="Remover m�trica",h.onclick=function(){deleteRow(this)},e.appendChild(h),o=document.createElement("input"),o.type="text",o.placeholder="Informe o nome da m�trica",o.className="form-control col-xs-6",o.id="MetricaList[".concat(t.rows.length-2)+"].MetricName",o.name="MetricaList[".concat(t.rows.length-2)+"].MetricName",e.appendChild(o),i=document.createElement("input"),i.type="number",i.placeholder="Informe o peso da m�trica",i.className="form-control col-xs-6",i.id="MetricaList[".concat(t.rows.length-2)+"].Weigth",i.name="MetricaList[".concat(t.rows.length-2)+"].Weigth",i.min="1",e.appendChild(i),r=document.createElement("input"),r.type="number",r.placeholder="Valor M�nimo",r.className="form-control col-xs-6",r.id="MetricaList[".concat(t.rows.length-2)+"].MinValue",r.name="MetricaList[".concat(t.rows.length-2)+"].MinValue",r.min="1",e.appendChild(r),u=document.createElement("input"),u.type="number",u.placeholder="Valor M�ximo",u.className="form-control col-xs-6",u.id="MetricaList[".concat(t.rows.length-2)+"].ValueMax",u.name="MetricaList[".concat(t.rows.length-2)+"].ValueMax",u.min="1",e.appendChild(u),f=document.createElement("select"),f.className="form-control col-xs-6",f.onchange=function(){showIcon(this,this.id)},f.style="float:left",f.id=t.rows.length-2,f.name="MetricaList[".concat(t.rows.length-2)+"].Icon",v=$("#IconsList").val(),c=v.split(";"),s=0;s<c.length-1;s++)l=document.createElement("option"),l.innerHTML=c[s],l.value=c[s],f.add(l,null);e.appendChild(f);a=document.createElement("i");a.className=t.rows.length-2+" col-xs-6";e.appendChild(a)}function deleteRow(n){var i=n.parentNode.parentNode.rowIndex,t=document.createElement("input");t.type="hidden";t.id="MetricaList[".concat(i-1)+"].FlagDeleted";t.name="MetricaList[".concat(i-1)+"].FlagDeleted";t.value="1";document.getElementById("permissions").rows[i].appendChild(t);document.getElementById("permissions").rows[i].style.display="none"}function getTeamsSelected(){for(var t=$(".teamsIdList"),i="",n=0;n<t.length;n++)t[n].checked&&(i+=t[n].value+",");$("#TeamsId").val($("#TeamsId").val()+i)}function getGoalsInputed(){getTeamsSelected();var n=$(".teamsGoalList"),u="",r=$("#TeamsId").val().split(","),t,i;if(r[0].length>0)for(i=0;i<r.length;i++)for(t=0;t<n.length;t++)if(r[i]==n[t].id.split(";")[1]&&n&&n.length>0)if(n[t].value&&n[t].value!=null&&n[t].value.length>0)u+=n[t].id.split(";")[1]+";"+n[t].value+",";else return $("#TeamsId").val(""),!1;return $("#GoalList").val(u),!0}function RemoveFromDatatable(n){for(var e,o,r="",u="",i=$("#TeamsId").val().split(","),f=$("#GoalList").val().split(","),t=0;t<i.length-1;t++)e=f[t].split(";")[0],o=f[t].split(";")[1],i[t]!=n&&(u+=e+";"+o+",",r+=i[t]+",");$("#TeamsId").val(r);$("#GoalList").val(u);loadTeamsFromCampaign()}function RemoveTableRow(n){var t=$(n).closest("tr");return t.fadeOut(400,function(){t.remove(!0)}),!1}function checkIfIsEnable(){var n=$("#ProfileId"),t=!1;n&&n.val()>0&&(t=!0);$("#addPlayers").attr("disabled",!t);profileId=$("#ProfileId").val()}function showIcon(n,t){var i=$("."+t);i.removeClass();i.addClass(t+" col-xs-6 fa");i.addClass(n.options[n.selectedIndex].value.replace(/_/g,"-"));i.show()}function removeTeamFromServer(n){$.ajax({type:"GET",url:"/admin/campanhas/removerAssociacao/"+n,dataType:"html",cache:!1,async:!0,success:function(){loadTeamsFromCampaign()},error:function(){alert("Erro ao remover a equipe.")}})}function removeMetric(n,t){$.ajax({type:"GET",url:"/admin/campanhas/removerMetrica/"+n,dataType:"html",cache:!1,async:!0,success:function(n){n?alert(n):deleteRow(t)},error:function(){alert("Erro ao remover a m�trica.")}})}function addTeam(){getGoalsInputed()?($("#closeModal").click(),loadTeamsFromCampaign()):alert("� necess�rio cadastrar a meta das equipes que ser�o adicionadas.")}var table;loadCampaignsDataTable();loadTeamsFromCampaign();var currentDate=new Date,dateInitial=moment($("#InitialDate").val(),"DD/MM/YYYY HH:mm:SS").toDate(),dateEnd=moment($("#EndDate").val(),"DD/MM/YYYY HH:mm:SS").toDate();$("#EndDate").datepicker({language:"pt-BR",changeMonth:!0,showOtherMonths:!0,selectOtherMonths:!0,selectOtherYears:!0,changeYear:!0});$("#EndDate").val()=="01/01/0001 00:00:00"?$("#EndDate").datepicker("setDate",currentDate):$("#EndDate").datepicker("setDate",dateEnd);$("#InitialDate").datepicker({language:"pt-BR",changeMonth:!0,showOtherMonths:!0,selectOtherMonths:!0,selectOtherYears:!0,changeYear:!0});$("#InitialDate").val()=="01/01/0001 00:00:00"?$("#InitialDate").datepicker("setDate",currentDate):$("#InitialDate").datepicker("setDate",dateInitial);$("#rootwizard").bootstrapWizard({tabClass:"nav nav-tabs tabdrop",onTabShow:function(n,t,i){var r=t.find("li").not(".tabdrop").length,u=i+1,f=u/r*100;$("#rootwizard").find("#bar .progress-bar").css({width:f+"%"});u>=r?($("#rootwizard").find(".pager .next").hide(),$("#rootwizard").find(".pager .finish").show(),$("#rootwizard").find(".pager .finish").removeClass("disabled")):($("#rootwizard").find(".pager .next").show(),$("#rootwizard").find(".pager .finish").hide())},onNext:function(n,t,i){var r=$(".form"+i);n.addClass("success")},onTabClick:function(n,t,i){var r=$(".form"+(i+1));n.addClass("success")}});$(".tabdrop").tabdrop({text:'<i class="fa fa-th-list"><\/i>'});checkIfIsEnable();